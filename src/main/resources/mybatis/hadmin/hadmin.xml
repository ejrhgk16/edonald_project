<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edonald.hadmin.dao.HadminMapper">
	<insert id="insertPromotion">
		INSERT INTO promotion
		VALUES(null,#{p_title},#{p_img},default)
	</insert>
	<select id="getPromotionList"
		resultType="com.edonald.hadmin.dto.PromotionDto">
		SELECT * FROM promotion ORDER BY p_seq DESC
	</select>
	<select id="getPromotion"
		resultType="com.edonald.hadmin.dto.PromotionDto">
		SELECT * FROM promotion WHERE p_seq = #{p_seq}
	</select>
	<update id="updatePromotion">
		UPDATE promotion SET p_title = #{p_title}, p_status = #{p_status}
		<if test="p_img != null">, p_img = #{p_img} </if>
		WHERE p_seq = #{p_seq}
	</update>

	<select id="getChartDataAll" resultType="int">
		select ifnull(a.total,0)
		from
		<if test="dateStandard == 'month'.toString() ">
		(
		select date_format(order_date, '%Y-%m')as yyyymmdd, sum(final_price) as total from order_list
		<if test="search!=null and !search.equals('') ">where store_code = #{search}</if>
		group by
		date_format(order_date,'%Y-%m')
		) a
		right join
		(
			select @N := @N +1 AS n ,
			date_format( date_add( LAST_DAY(NOW() - interval Month(now()) month)+interval 1
			DAY , interval @N -1 month),'%Y-%m') as yyyymmdd
			from (order_list), (select @N:=0 from dual ) a
			limit 12
	)
	</if>
	<if test="dateStandard == 'day'.toString() ">
	  ( 
      SELECT DATE_FORMAT(order_date, '%Y-%m-%d') AS yyyymmdd, SUM(final_price) AS total
      FROM order_list 
      GROUP BY DATE_FORMAT(order_date, '%Y-%m-%d')  
      ) a  
      RIGHT JOIN  
      ( 
      SELECT  @N := @N +1 AS n ,  
      DATE_FORMAT( DATE_ADD( NOW() - INTERVAL 6 DAY , INTERVAL @N -1 DAY),'%Y-%m-%d') AS yyyymmdd  
      FROM (order_list), (SELECT @N:=0 FROM DUAL ) a  
      LIMIT 7
      )
	</if>
		 b on a.yyyymmdd = b.yyyymmdd
		order by b.yyyymmdd asc
	</select>
</mapper>