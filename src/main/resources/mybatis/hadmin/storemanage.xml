<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edonald.hadmin.dao.StoreManageMapper">
	<insert id="insertStore">
		insert into store_list(store_address, store_name,
		store_phone, store_delivery, store_driverthru, store_status,
		store_code, store_log, store_lat)
		values(#{store_address},
		#{store_name}, #{store_phone}, #{store_delivery}, #{store_driverthru},
		#{store_status}, #{store_code}, #{store_log}, #{store_lat})
	</insert>

	<select id="getTotalNum" resultType="int">
		SELECT COUNT(store_code)
		FROM store_list
		WHERE 1=1
	</select>

	<select id="getStoreList" resultType="com.edonald.hadmin.dto.StoreDto">
		SELECT s.*,u.user_name,u.user_phone FROM store_list s LEFT JOIN user_info u ON s.store_code = u.store_code ORDER BY store_code,store_address ASC
	</select>

	<insert id="joinSadmin">
		INSERT INTO user_info(user_email, user_password, user_name, user_gender, user_status, user_phone, oauth, role, user_regdate, store_code)
		VALUES(#{user_email}, #{user_password}, #{user_name}, #{user_gender}, 1, #{user_phone}, 'edonald', 'ROLE_SADMIN', sysdate(), #{store_code})
	</insert>
	
	<select id="checkDupl" resultType="string">
		SELECT user_email FROM user_info WHERE user_email = #{user_email}
	</select>
	
	<select id="getStore" resultType="com.edonald.hadmin.dto.StoreDto">
		SELECT s.*,u.user_name,u.user_phone FROM store_list s LEFT JOIN user_info u ON s.store_code = u.store_code WHERE s.store_code = #{store_code};
	</select>
	
	<update id="updateStore">
		UPDATE store_list SET store_name = #{store_name}, store_phone = #{store_phone}, store_driverthru = #{store_driverthru}, store_delivery = #{store_delivery} 
		<if test="store_status != -1">, store_status = {#store_status} </if>
		WHERE store_code = #{store_code}
	</update>

</mapper>